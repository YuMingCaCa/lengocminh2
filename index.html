<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω ƒêi·ªÉm Thi - qlylaodong-dev</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f4f4f9; }
        h1 { text-align: center; color: #333; }
        
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* Form Styles */
        .form-group { display: flex; gap: 10px; margin-bottom: 10px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 4px; flex: 1; }
        button#addBtn { padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button#addBtn:hover { background-color: #218838; }

        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; }
        tr:hover { background-color: #f1f1f1; }
        
        .delete-btn { background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .delete-btn:hover { background-color: #c82333; }
        
        .loading { text-align: center; color: #666; font-style: italic; }
    </style>
</head>
<body>

    <h1>Qu·∫£n L√Ω ƒêi·ªÉm Thi üéì</h1>

    <div class="card">
        <h3>Th√™m m√¥n h·ªçc m·ªõi</h3>
        <div class="form-group">
            <input type="text" id="subjectInput" placeholder="T√™n m√¥n h·ªçc (VD: To√°n Cao C·∫•p)">
            <input type="number" id="scoreInput" placeholder="ƒêi·ªÉm s·ªë" step="0.1" max="10">
            <button id="addBtn">L∆∞u ƒëi·ªÉm</button>
        </div>
    </div>

    <div class="card">
        <h3>B·∫£ng ƒëi·ªÉm c·ªßa t√¥i</h3>
        <table id="scoreTable">
            <thead>
                <tr>
                    <th>M√¥n h·ªçc</th>
                    <th>ƒêi·ªÉm</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
        <p id="loadingMsg" class="loading">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Firebase...</p>
    </div>

    <script type="module">
        // Import th∆∞ vi·ªán t·ª´ CDN (d√πng cho file HTML ch·∫°y tr·ª±c ti·∫øp)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // C·∫•u h√¨nh Firebase c·ªßa b·∫°n
        const firebaseConfig = {
            apiKey: "AIzaSyCET0_R6120tj389v5C62NhSLrBIk2CbIw",
            authDomain: "qlylaodong-dev.firebaseapp.com",
            projectId: "qlylaodong-dev",
            storageBucket: "qlylaodong-dev.firebasestorage.app",
            messagingSenderId: "789374516793",
            appId: "1:789374516793:web:29fb38ad0913f8b62e17e8",
            measurementId: "G-M2PJEBLMJF"
        };

        // Kh·ªüi t·∫°o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // T√™n collection trong database
        const COLLECTION_NAME = "exam_scores";

        // 1. CH·ª®C NƒÇNG TH√äM ƒêI·ªÇM
        const addBtn = document.getElementById('addBtn');
        const subjectInput = document.getElementById('subjectInput');
        const scoreInput = document.getElementById('scoreInput');

        addBtn.addEventListener('click', async () => {
            const subject = subjectInput.value;
            const score = scoreInput.value;

            if (!subject || !score) {
                alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n m√¥n v√† ƒëi·ªÉm!");
                return;
            }

            try {
                await addDoc(collection(db, COLLECTION_NAME), {
                    subject: subject,
                    score: parseFloat(score),
                    createdAt: serverTimestamp() // L∆∞u th·ªùi gian ƒë·ªÉ s·∫Øp x·∫øp
                });
                
                // Reset form
                subjectInput.value = '';
                scoreInput.value = '';
                subjectInput.focus();
            } catch (e) {
                console.error("L·ªói khi th√™m ƒëi·ªÉm: ", e);
                alert("C√≥ l·ªói x·∫£y ra, h√£y ki·ªÉm tra Console (F12) ho·∫∑c xem b·∫°n ƒë√£ b·∫≠t Firestore ch∆∞a.");
            }
        });

        // 2. CH·ª®C NƒÇNG HI·ªÇN TH·ªä V√Ä T·ª∞ ƒê·ªòNG C·∫¨P NH·∫¨T (REAL-TIME)
        const tableBody = document.getElementById('tableBody');
        const loadingMsg = document.getElementById('loadingMsg');

        // S·∫Øp x·∫øp theo th·ªùi gian t·∫°o m·ªõi nh·∫•t
        const q = query(collection(db, COLLECTION_NAME), orderBy("createdAt", "desc"));

        onSnapshot(q, (snapshot) => {
            loadingMsg.style.display = 'none'; // ·∫®n ch·ªØ ƒëang t·∫£i
            tableBody.innerHTML = ''; // X√≥a b·∫£ng c≈© ƒë·ªÉ render l·∫°i

            if (snapshot.empty) {
                tableBody.innerHTML = '<tr><td colspan="3" style="text-align:center">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>';
            }

            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                const row = `
                    <tr>
                        <td><strong>${data.subject}</strong></td>
                        <td>${data.score}</td>
                        <td>
                            <button class="delete-btn" data-id="${docSnap.id}">X√≥a</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });

            // G√°n s·ª± ki·ªán x√≥a cho c√°c n√∫t v·ª´a t·∫°o
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', handleDelete);
            });
        });

        // 3. CH·ª®C NƒÇNG X√ìA
        async function handleDelete(e) {
            if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒëi·ªÉm m√¥n n√†y kh√¥ng?')) {
                const id = e.target.getAttribute('data-id');
                try {
                    await deleteDoc(doc(db, COLLECTION_NAME, id));
                } catch (e) {
                    alert("X√≥a th·∫•t b·∫°i: " + e.message);
                }
            }
        }
    </script>
</body>
</html>
